<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAI Live Tracking - Kereta Api Indonesia</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --kai-blue: #003087;
            --kai-red: #D81F2A;
            --kai-yellow: #FFC107;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        #map { height: 100vh; width: 100%; }
        
        .custom-marker { background: none; border: none; }
        
        header {
            position: absolute;
            top: 0;
            width: 100%;
            background: white;
            color: white;
            text-align: center;
            padding: 10px 15px;
            font-weight: bold;
            font-size: 18px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-logo {
            height: 40px;
            margin-left: 15px;
        }
        
        .header-title {
            flex-grow: 1;
            text-align: center;
            color:var(--kai-blue);
        }
        
        #clock {
            font-size: 14px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 10px;
            margin-right: 15px;
        }
        
        #sidebar {
            position: absolute;
            left: 0;
            top: 60px;
            width: 320px;
            height: calc(100vh - 60px);
            background: white;
            z-index: 999;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar-content {
            padding: 20px;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .sidebar-header h2 {
            font-size: 20px;
            color: var(--kai-blue);
            margin: 0;
        }
        
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: var(--kai-red);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        .live-dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }
        
        .search-box:focus {
            outline: none;
            border-color: var(--kai-blue);
        }
        
        .train-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .train-card {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid var(--kai-red);
        }
        
        .train-card:hover {
            background: #e6f0fa;
            transform: translateX(5px);
        }
        
        .train-card.active {
            background: var(--kai-yellow);
            border-left-color: var(--kai-blue);
        }
        
        .train-code {
            font-weight: 700;
            color: var(--kai-red);
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .train-card.active .train-code {
            color: var(--kai-blue);
        }
        
        .train-name {
            font-size: 14px;
            color: #333;
            margin-bottom: 3px;
        }
        
        .train-route {
            font-size: 12px;
            color: #666;
        }
        
        .train-detail {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--kai-blue) 0%, #004ba8 100%);
            border-radius: 15px;
            color: white;
        }
        
        .detail-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .detail-label {
            opacity: 0.9;
        }
        
        .detail-value {
            font-weight: 600;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }
        
        .btn-track {
            background: var(--kai-yellow);
            color: var(--kai-blue);
        }
        
        .btn-track:hover {
            background: #ffb300;
            transform: translateY(-2px);
        }
        
        .btn-pause {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        
        .btn-pause:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .speed-select {
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-weight: 600;
            cursor: pointer;
        }
        
        .filter-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 6px 12px;
            border: 2px solid var(--kai-blue);
            background: white;
            color: var(--kai-blue);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: var(--kai-blue);
            color: white;
        }
        
        @media (max-width: 768px) {
            #sidebar {
                width: 100%;
                height: 40vh;
                top: auto;
                bottom: 0;
            }
            #clock {
                font-size: 12px;
                padding: 6px 10px;
            }
            .header-logo {
                height: 30px;
                margin-left: 10px;                
            }
            .header-title {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <header>
        <img src="download (1).jpg" alt="Logo KAI" class="header-logo">
        <div class="header-title">KAI Live Tracking - Real-Time Train Monitoring (RTTM)</div>
        <div id="clock"></div>
    </header>
    
    <div id="sidebar">
        <div class="sidebar-content">
            <div class="sidebar-header">
                <h2>Kereta Aktif</h2>
                <div class="live-indicator">
                    <div class="live-dot"></div>
                    LIVE
                </div>
            </div>
            
            <input type="text" id="search" class="search-box" placeholder="Cari kereta (misal: Argo Bromo)">
            
            <div class="filter-group">
                <button class="filter-btn active" data-filter="all">Semua</button>
                <button class="filter-btn" data-filter="Eksekutif">Eksekutif</button>
                <button class="filter-btn" data-filter="Bisnis">Bisnis</button>
                <button class="filter-btn" data-filter="Ekonomi">Ekonomi</button>
                <button class="filter-btn" data-filter="Commuter">KRL</button>
            </div>
            
            <div class="train-list" id="trainList"></div>
            
            <div id="trainDetail" style="display: none;"></div>
        </div>
    </div>
    
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Real-time clock in WIB (UTC+7)
        function updateClock() {
            const now = new Date();
            const wibOffset = 7 * 60; // WIB is UTC+7
            const wibTime = new Date(now.getTime() + wibOffset * 60 * 1000);
            const hours = String(wibTime.getUTCHours()).padStart(2, '0');
            const minutes = String(wibTime.getUTCMinutes()).padStart(2, '0');
            const seconds = String(wibTime.getUTCSeconds()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds} WIB`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Expanded station coordinates
        const stations = {
            'Gambir': [-6.1754, 106.8271],
            'Pasar Senen': [-6.1472, 106.8410],
            'Jatinegara': [-6.2153, 106.8703],
            'Bekasi': [-6.2342, 106.9901],
            'Cikampek': [-6.4193, 107.4554],
            'Purwakarta': [-6.5537, 107.4438],
            'Cirebon': [-6.7347, 108.5508],
            'Indramayu': [-6.3260, 108.3300],
            'Brebes': [-6.9710, 109.0200],
            'Tegal': [-6.8694, 109.1404],
            'Pekalongan': [-6.8886, 109.6753],
            'Batang': [-6.9800, 109.7300],
            'Semarang Tawang': [-6.9833, 110.4167],
            'Semarang Poncol': [-7.0051, 110.4381],
            'Solo Balapan': [-7.5561, 110.8231],
            'Klaten': [-7.7107, 110.6068],
            'Lempuyangan': [-7.7900, 110.3738],
            'Yogyakarta': [-7.7889, 110.3636],
            'Kutoarjo': [-7.7167, 109.9167],
            'Purwokerto': [-7.4259, 109.2391],
            'Kroya': [-7.6314, 109.2451],
            'Madiun': [-7.6198, 111.5234],
            'Nganjuk': [-7.6026, 111.9041],
            'Kertosono': [-7.5863, 112.1001],
            'Mojokerto': [-7.4663, 112.4336],
            'Surabaya Gubeng': [-7.2655, 112.7521],
            'Surabaya Pasarturi': [-7.2401, 112.7344],
            'Sidoarjo': [-7.4478, 112.7185],
            'Malang': [-7.9778, 112.6307],
            'Bandung': [-6.9147, 107.6098],
            'Cimahi': [-6.8722, 107.5422],
            'Tasikmalaya': [-7.3297, 108.2208],
            'Banjar': [-7.3706, 108.5417],
            'Bogor': [-6.5947, 106.7828],
            'Depok': [-6.3944, 106.8281],
            'Tangerang': [-6.1781, 106.6299],
            'Serpong': [-6.2986, 106.6514],
            'Rangkasbitung': [-6.3422, 106.2462],
            'Sudirman': [-6.2088, 106.8456],
            'Tanah Abang': [-6.1864, 106.8117],
            'Cilacap': [-7.7361, 109.0103],
            'Kediri': [-7.8167, 112.0167],
            'Jombang': [-7.5549, 112.2331],
            'Blitar': [-8.0956, 112.1681],
            'Probolinggo': [-7.7496, 113.2161],
            'Banyuwangi': [-8.2150, 114.3678],
            'Jember': [-8.1650, 113.7027],
            'Medan': [3.5902, 98.6790],
            'Binjai': [3.6001, 98.4854],
            'Tebing Tinggi': [3.3263, 99.1625],
            'Pematang Siantar': [2.9595, 99.0687],
            'Tanjungbalai': [2.9667, 99.8000],
            'Kisaran': [2.9845, 99.6158],
            'Rantau Prapat': [2.0931, 99.8335]
        };

        // Expanded route coordinates with catenary support
        const routeCoords = {
            '1A': [  // Argo Bromo Anggrek: Gambir → Surabaya Gubeng
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.3000, 107.0000], [-6.4193, 107.4554],
                [-6.5537, 107.4438], [-6.6500, 107.9500], [-6.7347, 108.5508], [-6.8000, 108.7000], [-6.8500, 108.8500],
                [-6.8694, 109.1404], [-6.9000, 109.4000], [-6.8886, 109.6753], [-6.9500, 109.9000], [-7.0000, 110.1000],
                [-6.9833, 110.4167], [-7.1000, 110.5000], [-7.2000, 110.6000], [-7.5561, 110.8231], [-7.6198, 111.5234],
                [-7.6026, 111.9041], [-7.5863, 112.1001], [-7.5000, 112.3000], [-7.4663, 112.4336], [-7.3500, 112.6000],
                [-7.2655, 112.7521]
            ],
            '29F': [  // Argo Anjasmoro: Surabaya Pasarturi → Gambir
                [-7.2401, 112.7344], [-7.3500, 112.6000], [-7.4663, 112.4336], [-7.5000, 112.3000], [-7.5863, 112.1001],
                [-7.6026, 111.9041], [-7.6198, 111.5234], [-7.5561, 110.8231], [-7.2000, 110.6000], [-7.1000, 110.5000],
                [-6.9833, 110.4167], [-7.0000, 110.1000], [-6.9500, 109.9000], [-6.8886, 109.6753], [-6.9000, 109.4000],
                [-6.8694, 109.1404], [-6.8500, 108.8500], [-6.8000, 108.7000], [-6.7347, 108.5508], [-6.6500, 107.9500],
                [-6.5537, 107.4438], [-6.4193, 107.4554], [-6.3000, 107.0000], [-6.2342, 106.9901], [-6.2153, 106.8703],
                [-6.1754, 106.8271]
            ],
            '31E': [  // Taksaka: Gambir → Yogyakarta
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.3000, 107.0000], [-6.4193, 107.4554],
                [-6.5537, 107.4438], [-6.6500, 107.9500], [-6.7347, 108.5508], [-6.8000, 108.7000], [-6.8500, 108.8500],
                [-6.8694, 109.1404], [-6.9000, 109.4000], [-6.8886, 109.6753], [-6.9500, 109.9000], [-7.0000, 110.1000],
                [-6.9833, 110.4167], [-7.1000, 110.5000], [-7.2000, 110.6000], [-7.5561, 110.8231], [-7.7107, 110.6068],
                [-7.7500, 110.4000], [-7.7889, 110.3636]
            ],
            '85': [  // Argo Parahyangan: Gambir → Bandung
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.3000, 107.1000], [-6.4193, 107.4554],
                [-6.5537, 107.4438], [-6.7000, 107.5000], [-6.8000, 107.5500], [-6.8722, 107.5422], [-6.9147, 107.6098]
            ],
            '47': [  // Gajayana: Gambir → Malang
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.3000, 107.0000], [-6.4193, 107.4554],
                [-6.5537, 107.4438], [-6.6500, 107.9500], [-6.7347, 108.5508], [-6.8000, 108.7000], [-6.8500, 108.8500],
                [-6.8694, 109.1404], [-6.9000, 109.4000], [-6.8886, 109.6753], [-6.9500, 109.9000], [-7.0000, 110.1000],
                [-6.9833, 110.4167], [-7.1000, 110.5000], [-7.2000, 110.6000], [-7.5561, 110.8231], [-7.6198, 111.5234],
                [-7.6026, 111.9041], [-7.5863, 112.1001], [-7.5000, 112.3000], [-7.4663, 112.4336], [-7.3500, 112.6000],
                [-7.4478, 112.7185], [-7.9000, 112.6500], [-7.9778, 112.6307]
            ],
            'KRL-1': [  // KRL Bogor Line: Jakarta → Bogor
                [-6.1754, 106.8271], [-6.1472, 106.8410], [-6.2153, 106.8703], [-6.3944, 106.8281], [-6.5000, 106.8000],
                [-6.5947, 106.7828]
            ],
            'KRL-2': [  // KRL Bekasi Line: Jakarta → Bekasi
                [-6.1754, 106.8271], [-6.1472, 106.8410], [-6.2153, 106.8703], [-6.2342, 106.9901]
            ],
            'KRL-3': [  // KRL Tangerang: Jakarta → Tangerang
                [-6.1754, 106.8271], [-6.2000, 106.8300], [-6.2200, 106.8200], [-6.1781, 106.6299]
            ],
            '51': [  // Brantas: Gambir → Surabaya
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.3000, 107.0000], [-6.4193, 107.4554],
                [-6.5537, 107.4438], [-6.6500, 107.9500], [-6.7347, 108.5508], [-6.8000, 108.7000], [-6.8500, 108.8500],
                [-6.8694, 109.1404], [-6.9000, 109.4000], [-6.8886, 109.6753], [-6.9500, 109.9000], [-7.0000, 110.1000],
                [-6.9833, 110.4167], [-7.1000, 110.5000], [-7.2000, 110.6000], [-7.5561, 110.8231], [-7.6198, 111.5234],
                [-7.6026, 111.9041], [-7.5863, 112.1001], [-7.5000, 112.3000], [-7.4663, 112.4336], [-7.2655, 112.7521]
            ],
            '69': [  // Pasundan: Gambir → Bandung
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.3000, 107.1000], [-6.4193, 107.4554],
                [-6.5537, 107.4438], [-6.7000, 107.5000], [-6.8000, 107.5500], [-6.9147, 107.6098]
            ],
            '3A': [  // Bima: Gambir → Solo Balapan
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.3000, 107.0000], [-6.4193, 107.4554],
                [-6.5537, 107.4438], [-6.6500, 107.9500], [-6.7347, 108.5508], [-6.8000, 108.7000], [-6.8500, 108.8500],
                [-6.8694, 109.1404], [-6.9000, 109.4000], [-6.8886, 109.6753], [-6.9500, 109.9000], [-7.0000, 110.1000],
                [-6.9833, 110.4167], [-7.1000, 110.5000], [-7.2000, 110.6000], [-7.5561, 110.8231]
            ],
            '9A': [  // Argo Sindoro: Gambir → Semarang Tawang
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.3000, 107.0000], [-6.4193, 107.4554],
                [-6.5537, 107.4438], [-6.6500, 107.9500], [-6.7347, 108.5508], [-6.8000, 108.7000], [-6.8500, 108.8500],
                [-6.8694, 109.1404], [-6.9000, 109.4000], [-6.8886, 109.6753], [-6.9500, 109.9000], [-7.0000, 110.1000],
                [-6.9833, 110.4167]
            ],
            'Sancaka': [  // Sancaka: Surabaya Gubeng → Solo Balapan
                [-7.2655, 112.7521], [-7.4663, 112.4336], [-7.5863, 112.1001], [-7.6198, 111.5234], [-7.5561, 110.8231]
            ],
            'ArgoWilis': [  // Argo Wilis: Surabaya → Bandung
                [-7.2655, 112.7521], [-7.4663, 112.4336], [-7.5863, 112.1001], [-7.6198, 111.5234], [-7.5561, 110.8231],
                [-7.2000, 110.6000], [-7.1000, 110.5000], [-6.9833, 110.4167], [-7.0000, 110.1000], [-6.8886, 109.6753],
                [-6.9000, 109.4000], [-6.8694, 109.1404], [-6.8500, 108.8500], [-6.8000, 108.7000], [-6.7347, 108.5508],
                [-6.6500, 107.9500], [-6.5537, 107.4438], [-6.4193, 107.4554], [-6.3000, 107.1000], [-6.9147, 107.6098]
            ],
            'KRL-BSD': [  // KRL BSD: Sudirman → BSD
                [-6.2088, 106.8456], [-6.2200, 106.8300], [-6.2400, 106.8100], [-6.2600, 106.7900], [-6.2800, 106.7700],
                [-6.2986, 106.6514]
            ],
            'KRL-RCN': [  // KRL Rangkasbitung: Tanah Abang → Rangkasbitung
                [-6.1864, 106.8117], [-6.2200, 106.8300], [-6.2400, 106.8000], [-6.2600, 106.7700], [-6.2800, 106.7400],
                [-6.3000, 106.7100], [-6.3422, 106.2462]
            ],
            '17': [  // Argo Cheribon: Gambir → Cirebon
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.3000, 107.0000], [-6.4193, 107.4554],
                [-6.5537, 107.4438], [-6.6500, 107.9500], [-6.7347, 108.5508]
            ],
            '25': [  // Argo Jati: Gambir → Cirebon
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.4193, 107.4554], [-6.5537, 107.4438],
                [-6.7347, 108.5508]
            ],
            '55': [  // Matarmaja: Pasar Senen → Malang
                [-6.1472, 106.8410], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.4193, 107.4554], [-6.5537, 107.4438],
                [-6.7347, 108.5508], [-6.8694, 109.1404], [-6.8886, 109.6753], [-6.9833, 110.4167], [-7.5561, 110.8231],
                [-7.6198, 111.5234], [-7.5863, 112.1001], [-7.4663, 112.4336], [-7.4478, 112.7185], [-7.9778, 112.6307]
            ],
            '57': [  // Jayabaya: Pasar Senen → Surabaya Pasarturi
                [-6.1472, 106.8410], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.4193, 107.4554], [-6.5537, 107.4438],
                [-6.7347, 108.5508], [-6.8694, 109.1404], [-6.8886, 109.6753], [-6.9833, 110.4167], [-7.5561, 110.8231],
                [-7.6198, 111.5234], [-7.5863, 112.1001], [-7.4663, 112.4336], [-7.2401, 112.7344]
            ],
            '75': [  // Kahuripan: Bandung → Blitar
                [-6.9147, 107.6098], [-6.8722, 107.5422], [-7.3297, 108.2208], [-7.3706, 108.5417], [-7.4259, 109.2391],
                [-7.6314, 109.2451], [-7.7167, 109.9167], [-7.7889, 110.3636], [-7.6198, 111.5234], [-7.8167, 112.0167],
                [-8.0956, 112.1681]
            ],
            '87': [  // Serayu: Pasar Senen → Purwokerto
                [-6.1472, 106.8410], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.4193, 107.4554], [-6.5537, 107.4438],
                [-6.7347, 108.5508], [-6.8694, 109.1404], [-7.4259, 109.2391]
            ],
            '91': [  // Mutiara Selatan: Bandung → Surabaya Gubeng
                [-6.9147, 107.6098], [-6.8722, 107.5422], [-7.3297, 108.2208], [-7.3706, 108.5417], [-7.4259, 109.2391],
                [-7.6314, 109.2451], [-7.7167, 109.9167], [-7.7889, 110.3636], [-7.6198, 111.5234], [-7.5863, 112.1001],
                [-7.4663, 112.4336], [-7.2655, 112.7521]
            ],
            'Lodaya': [  // Lodaya: Bandung → Solo Balapan
                [-6.9147, 107.6098], [-6.8722, 107.5422], [-7.3297, 108.2208], [-7.3706, 108.5417], [-7.4259, 109.2391],
                [-7.6314, 109.2451], [-7.7167, 109.9167], [-7.7889, 110.3636], [-7.5561, 110.8231]
            ],
            'Kaligung': [  // Kaligung: Semarang Poncol → Tegal
                [-7.0051, 110.4381], [-6.9833, 110.4167], [-6.9500, 109.9000], [-6.8886, 109.6753], [-6.8694, 109.1404]
            ],
            'Bengawan': [  // Bengawan: Pasar Senen → Solo Balapan
                [-6.1472, 106.8410], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.4193, 107.4554], [-6.5537, 107.4438],
                [-6.7347, 108.5508], [-6.8694, 109.1404], [-6.8886, 109.6753], [-6.9833, 110.4167], [-7.5561, 110.8231]
            ],
            'Harina': [  // Harina: Surabaya Pasarturi → Bandung
                [-7.2401, 112.7344], [-7.4663, 112.4336], [-7.5863, 112.1001], [-7.6198, 111.5234], [-7.5561, 110.8231],
                [-7.7889, 110.3636], [-7.7167, 109.9167], [-7.4259, 109.2391], [-7.3706, 108.5417], [-7.3297, 108.2208],
                [-6.9147, 107.6098]
            ],
            'Fajar Utama': [  // Fajar Utama: Pasar Senen → Yogyakarta
                [-6.1472, 106.8410], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.4193, 107.4554], [-6.5537, 107.4438],
                [-6.7347, 108.5508], [-6.8694, 109.1404], [-6.8886, 109.6753], [-6.9833, 110.4167], [-7.5561, 110.8231],
                [-7.7889, 110.3636]
            ],
            'Sembrani': [  // Sembrani: Gambir → Surabaya Gubeng
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.4193, 107.4554], [-6.5537, 107.4438],
                [-6.7347, 108.5508], [-6.8694, 109.1404], [-6.8886, 109.6753], [-6.9833, 110.4167], [-7.5561, 110.8231],
                [-7.6198, 111.5234], [-7.5863, 112.1001], [-7.4663, 112.4336], [-7.2655, 112.7521]
            ],
            'Kertajaya': [  // Kertajaya: Surabaya Pasarturi → Pasar Senen
                [-7.2401, 112.7344], [-7.4663, 112.4336], [-7.5863, 112.1001], [-7.6198, 111.5234], [-7.5561, 110.8231],
                [-6.9833, 110.4167], [-6.8886, 109.6753], [-6.8694, 109.1404], [-6.7347, 108.5508], [-6.5537, 107.4438],
                [-6.4193, 107.4554], [-6.2342, 106.9901], [-6.2153, 106.8703], [-6.1472, 106.8410]
            ],
            'Sri Tanjung': [  // Sri Tanjung: Yogyakarta → Banyuwangi
                [-7.7889, 110.3636], [-7.7107, 110.6068], [-7.5561, 110.8231], [-7.6198, 111.5234], [-7.5863, 112.1001],
                [-7.4663, 112.4336], [-7.4478, 112.7185], [-7.7496, 113.2161], [-8.1650, 113.7027], [-8.2150, 114.3678]
            ],
            'Tawang Alun': [  // Tawang Alun: Malang → Banyuwangi
                [-7.9778, 112.6307], [-7.4478, 112.7185], [-7.7496, 113.2161], [-8.1650, 113.7027], [-8.2150, 114.3678]
            ],
            'Kutojaya Utara': [  // Kutojaya Utara: Jakarta → Kutoarjo
                [-6.1754, 106.8271], [-6.2153, 106.8703], [-6.2342, 106.9901], [-6.4193, 107.4554], [-6.5537, 107.4438],
                [-6.7347, 108.5508], [-6.8694, 109.1404], [-6.8886, 109.6753], [-7.4259, 109.2391], [-7.7167, 109.9167]
            ],
            'Sribilah': [  // Sribilah: Medan → Rantau Prapat
                [3.5902, 98.6790], [3.6001, 98.4854], [3.3263, 99.1625], [2.9595, 99.0687], [2.9845, 99.6158], [2.0931, 99.8335]
            ],
            'Putri Deli': [  // Putri Deli: Medan → Tanjungbalai
                [3.5902, 98.6790], [3.6001, 98.4854], [3.3263, 99.1625], [2.9667, 99.8000]
            ],
            'KRL-Serpong': [  // KRL Serpong: Tanah Abang → Serpong
                [-6.1864, 106.8117], [-6.2200, 106.8300], [-6.2400, 106.8000], [-6.2600, 106.7700], [-6.2986, 106.6514]
            ]
        };

        // Expanded train dataset
        const trains = [
            { code: '1A', name: 'Argo Bromo Anggrek', type: 'Eksekutif', route: 'Gambir → Surabaya Gubeng', departure: '10:00', duration: 480, color: '#D81F2A', active: true },
            { code: '29F', name: 'Argo Anjasmoro', type: 'Eksekutif', route: 'Surabaya Pasarturi → Gambir', departure: '12:05', duration: 510, color: '#D81F2A', active: true },
            { code: '31E', name: 'Taksaka', type: 'Eksekutif', route: 'Gambir → Yogyakarta', departure: '07:00', duration: 420, color: '#D81F2A', active: true },
            { code: '85', name: 'Argo Parahyangan', type: 'Eksekutif', route: 'Gambir → Bandung', departure: '14:00', duration: 180, color: '#D81F2A', active: true },
            { code: '47', name: 'Gajayana', type: 'Eksekutif', route: 'Gambir → Malang', departure: '14:30', duration: 540, color: '#D81F2A', active: true },
            { code: 'KRL-1', name: 'KRL Bogor Line', type: 'Commuter', route: 'Jakarta → Bogor', departure: '06:00', duration: 60, color: '#FFC107', active: true },
            { code: 'KRL-2', name: 'KRL Bekasi Line', type: 'Commuter', route: 'Jakarta → Bekasi', departure: '06:15', duration: 45, color: '#FFC107', active: true },
            { code: 'KRL-3', name: 'KRL Tangerang', type: 'Commuter', route: 'Jakarta → Tangerang', departure: '06:30', duration: 50, color: '#FFC107', active: true },
            { code: '51', name: 'Brantas', type: 'Ekonomi', route: 'Gambir → Surabaya', departure: '13:00', duration: 540, color: '#003087', active: true },
            { code: '69', name: 'Pasundan', type: 'Ekonomi', route: 'Gambir → Bandung', departure: '08:00', duration: 210, color: '#003087', active: true },
            { code: '3A', name: 'Bima', type: 'Eksekutif', route: 'Gambir → Solo Balapan', departure: '15:00', duration: 360, color: '#D81F2A', active: true },
            { code: '9A', name: 'Argo Sindoro', type: 'Eksekutif', route: 'Gambir → Semarang Tawang', departure: '16:30', duration: 300, color: '#D81F2A', active: true },
            { code: 'Sancaka', name: 'Sancaka', type: 'Eksekutif', route: 'Surabaya Gubeng → Solo Balapan', departure: '10:00', duration: 210, color: '#D81F2A', active: true },
            { code: 'ArgoWilis', name: 'Argo Wilis', type: 'Eksekutif', route: 'Surabaya → Bandung', departure: '09:00', duration: 480, color: '#D81F2A', active: true },
            { code: 'KRL-BSD', name: 'KRL BSD Line', type: 'Commuter', route: 'Sudirman → BSD', departure: '07:00', duration: 45, color: '#FFC107', active: true },
            { code: 'KRL-RCN', name: 'KRL Rangkasbitung', type: 'Commuter', route: 'Tanah Abang → Rangkasbitung', departure: '08:00', duration: 90, color: '#FFC107', active: true },
            { code: '17', name: 'Argo Cheribon', type: 'Eksekutif', route: 'Gambir → Cirebon', departure: '05:30', duration: 180, color: '#D81F2A', active: true },
            { code: '25', name: 'Argo Jati', type: 'Eksekutif', route: 'Gambir → Cirebon', departure: '17:00', duration: 180, color: '#D81F2A', active: true },
            { code: '55', name: 'Matarmaja', type: 'Ekonomi', route: 'Pasar Senen → Malang', departure: '15:20', duration: 600, color: '#003087', active: true },
            { code: '57', name: 'Jayabaya', type: 'Ekonomi', route: 'Pasar Senen → Surabaya Pasarturi', departure: '17:30', duration: 570, color: '#003087', active: true },
            { code: '75', name: 'Kahuripan', type: 'Ekonomi', route: 'Bandung → Blitar', departure: '19:00', duration: 480, color: '#003087', active: true },
            { code: '87', name: 'Serayu', type: 'Ekonomi', route: 'Pasar Senen → Purwokerto', departure: '06:30', duration: 360, color: '#003087', active: true },
            { code: '71', name: 'Mutiara Selatan', type: 'Bisnis', route: 'Bandung → Surabaya Gubeng', departure: '18:00', duration: 510, color: '#007BFF', active: true },
            { code: 'Lodaya', name: 'Lodaya', type: 'Eksekutif', route: 'Bandung → Solo Balapan', departure: '07:00', duration: 420, color: '#D81F2A', active: true },
            { code: 'Kaligung', name: 'Kaligung', type: 'Ekonomi', route: 'Semarang Poncol → Tegal', departure: '09:00', duration: 120, color: '#003087', active: true },
            { code: 'Bengawan', name: 'Bengawan', type: 'Ekonomi', route: 'Pasar Senen → Solo Balapan', departure: '18:30', duration: 450, color: '#003087', active: true },
            { code: 'Harina', name: 'Harina', type: 'Eksekutif', route: 'Surabaya Pasarturi → Bandung', departure: '16:00', duration: 480, color: '#D81F2A', active: true },
            { code: 'Fajar Utama', name: 'Fajar Utama', type: 'Eksekutif', route: 'Pasar Senen → Yogyakarta', departure: '06:00', duration: 420, color: '#D81F2A', active: true },
            { code: 'Sembrani', name: 'Sembrani', type: 'Eksekutif', route: 'Gambir → Surabaya Gubeng', departure: '19:00', duration: 480, color: '#D81F2A', active: true },
            { code: 'Kertajaya', name: 'Kertajaya', type: 'Ekonomi', route: 'Surabaya Pasarturi → Pasar Senen', departure: '14:00', duration: 570, color: '#003087', active: true },
            { code: 'Sri Tanjung', name: 'Sri Tanjung', type: 'Ekonomi', route: 'Yogyakarta → Banyuwangi', departure: '07:00', duration: 360, color: '#003087', active: true },
            { code: 'Tawang Alun', name: 'Tawang Alun', type: 'Ekonomi', route: 'Malang → Banyuwangi', departure: '06:30', duration: 300, color: '#003087', active: true },
            { code: 'Kutojaya Utara', name: 'Kutojaya Utara', type: 'Ekonomi', route: 'Jakarta → Kutoarjo', departure: '09:00', duration: 360, color: '#003087', active: true },
            { code: 'Sribilah', name: 'Sribilah', type: 'Eksekutif', route: 'Medan → Rantau Prapat', departure: '07:30', duration: 240, color: '#D81F2A', active: true },
            { code: 'Putri Deli', name: 'Putri Deli', type: 'Ekonomi', route: 'Medan → Tanjungbalai', departure: '08:00', duration: 180, color: '#003087', active: true },
            { code: 'KRL-Serpong', name: 'KRL Serpong', type: 'Commuter', route: 'Tanah Abang → Serpong', departure: '07:30', duration: 45, color: '#FFC107', active: true }
        ];

        // Initialize map centered on Java
        const map = L.map('map').setView([-7.0, 110.0], 7);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors | KAI 2025'
        }).addTo(map);

        const trainIcon = L.divIcon({
            html: `<svg width="24" height="16" viewBox="0 0 32 20" fill="none">
                <rect x="0" y="2" width="32" height="16" rx="3" fill="#D81F2A"/>
                <rect x="2" y="5" width="4" height="8" fill="#FFF" rx="1"/>
                <rect x="8" y="5" width="4" height="8" fill="#FFF" rx="1"/>
                <rect x="14" y="5" width="4" height="8" fill="#FFF" rx="1"/>
                <rect x="20" y="5" width="4" height="8" fill="#FFF" rx="1"/>
                <rect x="26" y="5" width="4" height="8" fill="#FFF" rx="1"/>
                <circle cx="6" cy="18" r="2" fill="#000"/>
                <circle cx="26" cy="18" r="2" fill="#000"/>
            </svg>`,
            iconSize: [24, 16],
            iconAnchor: [12, 8],
            className: 'custom-marker'
        });

        let trainMarkers = {};
        let trainRoutes = {};
        let selectedTrain = null;
        let animationIntervals = {};

        function renderTrains() {
            trains.forEach(train => {
                if (!routeCoords[train.code]) return; // Skip if no coords
                const coords = routeCoords[train.code];
                
                // Draw route with thinner, more realistic line
                const route = L.polyline(coords, {
                    color: train.color,
                    weight: 2,
                    opacity: 0.8,
                    smoothFactor: 1
                }).addTo(map);
                
                // Add catenary-like overhead lines
                const catenaryCoords = coords.map(([lat, lng]) => [lat + 0.0003, lng]);
                const catenary = L.polyline(catenaryCoords, {
                    color: '#D81F2A',
                    weight: 0.5,
                    dashArray: '2, 4',
                    opacity: 0.6
                }).addTo(map);
                
                // Add marker at starting position
                const marker = L.marker(coords[0], { icon: trainIcon }).addTo(map);
                marker.bindPopup(`<b>${train.name}</b><br>${train.code}`);
                
                trainMarkers[train.code] = marker;
                trainRoutes[train.code] = { route, catenary, coords };
                
                // Start realistic animation
                animateTrainRealistic(train.code, coords, train);
            });
        }

        // Realistic animation based on departure time and duration
        function animateTrainRealistic(code, coords, train) {
            const totalPoints = coords.length;
            let startTime = new Date(`2025-10-02 ${train.departure}:00`);
            const interval = 5000; // Update every 5 seconds

            animationIntervals[code] = setInterval(() => {
                const now = new Date();
                const elapsed = (now - startTime) / 1000 / 60; // minutes elapsed
                let progress = Math.max(0, Math.min(1, elapsed / train.duration));
                
                // If completed, reset or loop
                if (progress >= 1) {
                    progress = 0;
                    startTime = new Date(now.getTime() + 24 * 60 * 60 * 1000); // Next day
                }
                
                const index = Math.floor(progress * (totalPoints - 1));
                const frac = (progress * (totalPoints - 1)) - index;
                
                if (index < totalPoints - 1) {
                    const lat = coords[index][0] + frac * (coords[index + 1][0] - coords[index][0]);
                    const lng = coords[index][1] + frac * (coords[index + 1][1] - coords[index][1]);
                    trainMarkers[code].setLatLng([lat, lng]);
                }
            }, interval);
        }

        function renderTrainList(filter = 'all') {
            const list = document.getElementById('trainList');
            const filtered = filter === 'all' ? trains : trains.filter(t => t.type === filter);
            
            list.innerHTML = filtered.map(train => `
                <div class="train-card" data-code="${train.code}">
                    <div class="train-code">${train.code}</div>
                    <div class="train-name">${train.name}</div>
                    <div class="train-route">${train.route}</div>
                </div>
            `).join('');
            
            document.querySelectorAll('.train-card').forEach(card => {
                card.addEventListener('click', () => showTrainDetail(card.dataset.code));
            });
        }

        function showTrainDetail(code) {
            if (selectedTrain) {
                document.querySelector(`[data-code="${selectedTrain}"]`)?.classList.remove('active');
            }
            
            selectedTrain = code;
            document.querySelector(`[data-code="${code}"]`).classList.add('active');
            
            const train = trains.find(t => t.code === code);
            const detail = document.getElementById('trainDetail');
            
            detail.style.display = 'block';
            detail.innerHTML = `
                <div class="train-detail">
                    <div class="detail-title">${train.name} (${train.code})</div>
                    <div class="detail-row">
                        <span class="detail-label">Tipe</span>
                        <span class="detail-value">${train.type}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Rute</span>
                        <span class="detail-value">${train.route}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Berangkat</span>
                        <span class="detail-value">${train.departure} WIB</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Durasi</span>
                        <span class="detail-value">${Math.floor(train.duration/60)}j ${train.duration%60}m</span>
                    </div>
                    <div class="control-buttons">
                        <button class="btn btn-track" onclick="focusTrain('${code}')">Lacak</button>
                        <button class="btn btn-pause" onclick="pauseTrain('${code}')">Pause</button>
                    </div>
                </div>
            `;
            
            focusTrain(code);
        }

        function focusTrain(code) {
            const { coords } = trainRoutes[code];
            map.fitBounds(coords, { padding: [50, 50] });
            trainMarkers[code].openPopup();
        }

        function pauseTrain(code) {
            if (animationIntervals[code]) {
                clearInterval(animationIntervals[code]);
                delete animationIntervals[code];
            }
        }

        // Search functionality
        document.getElementById('search').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            document.querySelectorAll('.train-card').forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query) ? 'block' : 'none';
            });
        });

        // Filter functionality
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderTrainList(btn.dataset.filter);
            });
        });

        // Initialize
        renderTrains();
        renderTrainList();
    </script>
</body>
</html>